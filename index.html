<!DOCTYPE html>
<html>
<head>
    <title>Donation & Expense Management</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
 .cardd{
    width: 90%;
    height: 230px;
    background: hsl(214, 35%, 67%);
    border-radius: 20px;
    display: flex;
    justify-content: center;
    align-items: center;
    position: relative;
    overflow: hidden;
}

.cardd p{
    z-index: 2;
    position: relative;
    color: #ffffff;
}
.cardd::after{
    z-index: 1;
}
.cardd::before{
    z-index: 0;
}



.cardd::before{
    content: "";
    position: absolute;
    width: 50%;
    height: 180%;
    background: linear-gradient(180deg, #ea00ff, #04ff64);
    animation: rotate 3s linear infinite;
}
.cardd::after{
    content: "";
    position: absolute;
    inset: 5px;
    background: #07182E;
    border-radius: 15px;
    z-index: 1;
}
@keyframes rotate{
    from{ transform: rotate(0deg); }
    to{ transform: rotate(360deg); }
}
body{
    font-family: Arial, sans-serif;
    background: #dce5f3;
    margin:0 auto;
    padding:10px;
    width: 400px;
}
.header{ font-size: 20px; font-weight: bold; margin-bottom: 20px; text-align: center; width: 95%; }
.ayt{ margin: 0 auto; font-size: 10px; width: 95%; background-color: white; margin-bottom: 20px; border-radius: 12px; padding: 10px; }
.card{
    background: rgb(255, 255, 255);
    padding: 20px;
    display: flex;
    flex-direction: column;
    margin-bottom: 20px;
    border-radius: 12px;
    box-shadow: 0 0 12px rgba(0,0,0,0.1);
}
button{
    padding: 20px;
    border:none;
    border-radius:20px;
    background:#007bff;
    color:white;
    cursor:pointer;
    font-size: 26px;
}
button:hover{ background:#063c77; }
input{
    width: 100%; padding:14px; margin:8px 0;
    font-size: 16px; box-sizing: border-box;
    border-radius:5px; border:1px solid #ccc;
}
.hidden{display:none;}
table{
    width:100%;
    border-collapse: collapse;
    margin-top:10px;
}
table, th, td{ border:1px solid #ccc; }
th, td{ padding:12px; text-align:left; font-size: 16px; }
th{ background:#007bff; color:white; }
.button-grid{ display: flex; flex-wrap: wrap; justify-content: space-between; gap:10px; }
.button-grid button{ width:48%; }
.button-grid-h{
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 10px;
}
.button-grid-h button{
    width:100%;
    height: 160px;
}
.list{
    text-decoration: none; 
    color: #ffffff; 
    background-color: #007bff; 
    padding: 5px; 
    width: 60px;
    text-align: center;
    margin-bottom: 4px;
    border-radius: 5px;
}
.MinDiv{
    width: 85%;
    height: 60px;
    margin: 0 auto;
    display: flex;
    flex-direction: row;
    margin-top: 10px;
    

}


.divImg  img{
    margin-left:20px ;
    width: 40px;
    height: 40px;
    border-radius: 5px;
    gap: 10px;
}
    </style>
</head>
<body>

    <div class="header">
        <h1>“মাহফিলের সব হিসাব এক ক্লিকে”</h1>
        <h4>সহজে হিসাব রাখুন, সময় বাঁচান, ঝামেলা কমান</h4>
    </div>

    <div class="card totals cardd" style="background-color: #010305; ">
        <p >মোট অনুদান: <span id="totalDonation">0</span> টাকা</p>
        <p>মোট খরচ: <span id="totalExpense">0</span> টাকা</p>
        <p>বর্তমান ক্যাশ আছে:<span id="balance">0</span> টাকা</p>
    </div>

    <div class="card" id="homeButtons">
        <div class="button-grid button-grid-h">
            <button onclick="showPasswordPrompt('donation')">অনুদান যোগ করুন</button>
            <button onclick="showPasswordPrompt('expense')">খরচ যোগ করুন</button>
            <button onclick="showPage('donationList')">অনুদানের হিসাব</button>
            <button onclick="showPage('expenseList')">খরচের হিসাব</button>
        </div>
    </div>

    <div class="card hidden" id="passwordDiv">
        <input type="password" id="passwordInput" placeholder="পাসওয়ার্ড লিখুন">
        <div class="button-grid">
            <button onclick="checkPassword()">সাবমিট</button>
            <button onclick="cancelPassword()">বাতিল</button>
        </div>
    </div>

    <div class="card hidden" id="donationFormDiv">
        <div class="header">অনুদান যোগ করুন</div>
        <input id="donorName" placeholder="দাতার নাম">
        <input id="donorPhone" placeholder="ঠিকানা">
        <input id="donorAmount" placeholder="টাকার পরিমাণ">
        <div class="button-grid">
            <button onclick="submitDonation()">সাবমিট</button>
            <button onclick="backHome()">Back</button>
        </div>
    </div>

    <div class="card hidden" id="expenseFormDiv">
        <div class="header">খরচ যোগ করুন</div>
        <input id="expensePurpose" placeholder="কোন কাজে খরচ">
        <input id="expenseBy" placeholder="কার মাধ্যমে">
        <input id="expenseAmount" placeholder="টাকার পরিমাণ">
        <div class="button-grid">
            <button onclick="submitExpense()">সাবমিট</button>
            <button onclick="backHome()">Back</button>
        </div>
    </div>

    <div class="card hidden" id="donationList">
        
        <!-- <div class="MinDiv">
            <div class="divImg"><a href="list-18.html"  ><img src="img/bech.png" alt=""></a></div>
            <div class="divImg"><a href="index.html"  ><img src="img/home.png" alt=""></a></div>
        </div> -->



        <div class="header">অনুদানের হিসাব</div>
        <div class="table-container">
            <table id="donationTable">
                <tr><th>SL</th><th>Name</th><th>Address</th><th>Amount</th></tr>
            </table>
        </div>
        <div style="margin-top:10px; display:flex; gap:10px;">
            <button onclick="downloadDonationPNG()">ডাউনলোড</button>
            <button onclick="backHome()">Back</button>
        </div>

         <!-- <div class="MinDiv">
            <div class="divImg"><a href="list-18.html"  ><img src="img/bech.png" alt=""></a></div>
            <div class="divImg"><a href="index.html"  ><img src="img/home.png" alt=""></a></div>
        </div> -->

    </div>

    <div class="card hidden" id="expenseList">
        <div class="header">খরচের হিসাব</div>
        <div class="table-container">
            <table id="expenseTable">
                <tr><th>SL</th><th>Purpose</th><th>By</th><th>Amount</th></tr>
            </table>
        </div>
        <div style="margin-top:10px; display:flex; gap:10px;">
            <button onclick="downloadExpensePNG()">ডাউনলোড</button>
            <button onclick="backHome()">Back</button>
        </div>
    </div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<script>
const DONATION_API = "https://691c4c4e3aaeed735c90492a.mockapi.io/donations";
const EXPENSE_API = "https://691c4c4e3aaeed735c90492a.mockapi.io/expense";
const PASSWORD = "2255";
let currentForm = "";

function showPasswordPrompt(form){
    currentForm = form;
    document.getElementById("homeButtons").classList.add("hidden");
    document.getElementById("passwordDiv").classList.remove("hidden");
}
function checkPassword(){
    const pass = document.getElementById("passwordInput").value;
    if(pass === PASSWORD){
        document.getElementById("passwordDiv").classList.add("hidden");
        document.getElementById("passwordInput").value = "";
        if(currentForm === "donation"){
            document.getElementById("donationFormDiv").classList.remove("hidden");
        }else{
            document.getElementById("expenseFormDiv").classList.remove("hidden");
        }
    }else{ alert("পাসওয়ার্ড ভুল!"); }
}
function cancelPassword(){
    document.getElementById("passwordDiv").classList.add("hidden");
    document.getElementById("passwordInput").value = "";
    document.getElementById("homeButtons").classList.remove("hidden");
}
function backHome(){
    document.getElementById("donationFormDiv").classList.add("hidden");
    document.getElementById("expenseFormDiv").classList.add("hidden");
    document.getElementById("donationList").classList.add("hidden");
    document.getElementById("expenseList").classList.add("hidden");
    document.getElementById("homeButtons").classList.remove("hidden");
    loadTotals();
}

/* SUBMIT */
function submitDonation(){
    const name = donorName.value;
    const phone = donorPhone.value;
    const amount = Number(bnToEnNumber(donorAmount.value)) || 0;
    if(!name || !phone || !amount){ alert("সব তথ্য পূরণ করুন"); return;}
    fetch(DONATION_API,{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({name, phone, amount})
    }).then(()=>{
        alert("অনুদান যোগ হয়েছে!");
        // Form stays on the same page; clear the fields and update totals/lists
        donorName.value = "";
        donorPhone.value = "";
        donorAmount.value = "";
        loadTotals();
        // If donation list is currently visible, refresh it
        if(!document.getElementById("donationList").classList.contains("hidden")){
            loadDonationList();
        }
    });
}

function submitExpense(){
    const purpose = expensePurpose.value;
    const by = expenseBy.value;
    const amount = Number(bnToEnNumber(expenseAmount.value)) || 0;
    if(!purpose || !by || !amount){ alert("সব তথ্য পূরণ করুন"); return;}
    fetch(EXPENSE_API,{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({purpose, by, amount})
    }).then(()=>{
        alert("খরচ যোগ হয়েছে!");
        // Form stays on the same page; clear the fields and update totals/lists
        expensePurpose.value = "";
        expenseBy.value = "";
        expenseAmount.value = "";
        loadTotals();
        // If expense list is currently visible, refresh it
        if(!document.getElementById("expenseList").classList.contains("hidden")){
            loadExpenseList();
        }
    });
}

/* Bengali to English number conversion */
function bnToEnNumber(str){
    if(typeof str !== 'string') str = String(str);
    const bn = "০১২৩৪৫৬৭৮৯";
    const en = "0123456789";
    let result = "";
    for(let i=0; i<str.length; i++){
        const ch = str[i];
        const idx = bn.indexOf(ch);
        if(idx > -1){
            result += en[idx];
        } else {
            result += ch;
        }
    }
    return result;
}

/* PAGE SHOW */
function showPage(page){
    homeButtons.classList.add("hidden");
    if(page === "donationList"){
        donationList.classList.remove("hidden");
        loadDonationList();
    }else{
        expenseList.classList.remove("hidden");
        loadExpenseList();
    }
}

/* LOAD TABLE */
function loadDonationList(){
    fetch(DONATION_API)
    .then(res=>res.json())
    .then(data=>{
        donationTable.innerHTML =
            "<tr><th>SL</th><th>Name</th><th>Address</th><th>Amount</th></tr>";
        let serial = 1;
        let total = 0;
        data.forEach(d=>{
            const row = donationTable.insertRow();
            row.insertCell(0).innerText = serial++;
            row.insertCell(1).innerText = d.name;
            row.insertCell(2).innerText = d.phone;
            row.insertCell(3).innerText = d.amount;
            total += Number(d.amount);
        });
        totalDonation.innerText = total;
        updateBalance();
    });
}

function loadExpenseList(){
    fetch(EXPENSE_API)
    .then(res=>res.json())
    .then(data=>{
        expenseTable.innerHTML =
            "<tr><th>SL</th><th>Purpose</th><th>By</th><th>Amount</th></tr>";
        let serial = 1;
        let total = 0;
        data.forEach(d=>{
            const row = expenseTable.insertRow();
            row.insertCell(0).innerText = serial++;
            row.insertCell(1).innerText = d.purpose;
            row.insertCell(2).innerText = d.by;
            row.insertCell(3).innerText = d.amount;
            total += Number(d.amount);
        });
        totalExpense.innerText = total;
        updateBalance();
    });
}

/* TOTAL */
function loadTotals(){
    Promise.all([
        fetch(DONATION_API).then(r=>r.json()),
        fetch(EXPENSE_API).then(r=>r.json())
    ]).then(([donations, expenses])=>{
        totalDonation.innerText =
            donations.reduce((a,b)=>a+Number(b.amount),0);
        totalExpense.innerText =
            expenses.reduce((a,b)=>a+Number(b.amount),0);
        updateBalance();
    });
}
function updateBalance(){
    balance.innerText =
        Number(totalDonation.innerText) - Number(totalExpense.innerText);
}

/* -------------------------
   PNG DOWNLOAD FUNCTIONS
--------------------------- */

function downloadPNG(elementId, filename){
    const element = document.getElementById(elementId);
    html2canvas(element,{scale:2}).then(canvas=>{
        const link = document.createElement("a");
        link.download = filename + ".png";
        link.href = canvas.toDataURL("image/png");
        link.click();
    });
}

function downloadDonationPNG(){
    downloadPNG("donationList", "donation_table");
}
function downloadExpensePNG(){
    downloadPNG("expenseList", "expense_table");
}

loadTotals();
</script>

</body>
</html>
